import streamlit as st
from gtts import gTTS
from PIL import Image
import uuid
import os

# Page config
st.set_page_config(
    page_title="KisanVaani",
    page_icon="üåæ",
    layout="centered"
)

st.title("üåæ KisanVaani")
st.subheader("‡∞∞‡±à‡∞§‡±Å‡∞≤ ‡∞ï‡±ã‡∞∏‡∞Ç ‡∞∏‡±ç‡∞Æ‡∞æ‡∞∞‡±ç‡∞ü‡±ç ‡∞µ‡±ç‡∞Ø‡∞µ‡∞∏‡∞æ‡∞Ø ‡∞∏‡∞π‡∞æ‡∞Ø‡∞ï‡±Å‡∞°‡±Å")

st.markdown(
    """
    ‚úÖ ‡∞™‡∞Ç‡∞ü‡∞≤‡∞™‡±à ‡∞∏‡∞Ç‡∞¶‡±á‡∞π‡∞æ‡∞≤‡±Å  
    ‚úÖ ‡∞µ‡±ç‡∞Ø‡∞æ‡∞ß‡∞ø / ‡∞™‡±Å‡∞∞‡±Å‡∞ó‡±Å ‡∞´‡±ã‡∞ü‡±ã ‡∞§‡±Ä‡∞∏‡∞ø ‡∞Ö‡∞°‡∞ó‡∞Ç‡∞°‡∞ø  
    ‚úÖ ‡∞∏‡∞Æ‡∞æ‡∞ß‡∞æ‡∞®‡∞Ç ‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å ‡∞µ‡∞æ‡∞Ø‡∞ø‡∞∏‡±ç‚Äå‡∞≤‡±ã  
    """
)

# ------------------ LOGIC ------------------

def respond(text: str):
    if "‡∞µ‡∞æ‡∞§‡∞æ‡∞µ‡∞∞‡∞£‡∞Ç" in text:
        return "‡∞à‡∞∞‡±ã‡∞ú‡±Å ‡∞µ‡∞æ‡∞§‡∞æ‡∞µ‡∞∞‡∞£‡∞Ç ‡∞µ‡±ç‡∞Ø‡∞µ‡∞∏‡∞æ‡∞Ø‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞Ö‡∞®‡±Å‡∞ï‡±Ç‡∞≤‡∞Ç‡∞ó‡∞æ ‡∞â‡∞Ç‡∞¶‡∞ø"

    elif "‡∞µ‡∞∞‡∞ø" in text:
        return "‡∞µ‡∞∞‡∞ø ‡∞™‡∞Ç‡∞ü‡∞ï‡±Å ‡∞∏‡∞Æ‡∞Ø‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞®‡±Ä‡∞∞‡±Å ‡∞Æ‡∞∞‡∞ø‡∞Ø‡±Å ‡∞∏‡∞∞‡±à‡∞® ‡∞é‡∞∞‡±Å‡∞µ‡±Å‡∞≤‡±Å ‡∞Ö‡∞µ‡∞∏‡∞∞‡∞Ç"

    elif "‡∞™‡±Å‡∞∞‡±Å‡∞ó‡±Å" in text or "‡∞µ‡±ç‡∞Ø‡∞æ‡∞ß‡∞ø" in text:
        return (
            "‡∞™‡∞Ç‡∞ü‡∞≤‡±ã ‡∞µ‡±ç‡∞Ø‡∞æ‡∞ß‡∞ø ‡∞≤‡±á‡∞¶‡∞æ ‡∞™‡±Å‡∞∞‡±Å‡∞ó‡±Å ‡∞≤‡∞ï‡±ç‡∞∑‡∞£‡∞æ‡∞≤‡±Å ‡∞ï‡∞®‡∞ø‡∞™‡∞ø‡∞∏‡±ç‡∞§‡±Å‡∞®‡±ç‡∞®‡∞æ‡∞Ø‡∞ø. "
            "‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞≤‡±á‡∞¨‡±Å‡∞≤‡±ç ‡∞∏‡±Ç‡∞ö‡∞®‡∞≤‡±Å ‡∞™‡∞æ‡∞ü‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø ‡∞≤‡±á‡∞¶‡∞æ ‡∞∏‡∞Æ‡±Ä‡∞™ ‡∞µ‡±ç‡∞Ø‡∞µ‡∞∏‡∞æ‡∞Ø ‡∞Ö‡∞ß‡∞ø‡∞ï‡∞æ‡∞∞‡∞ø‡∞®‡∞ø ‡∞∏‡∞Ç‡∞™‡±ç‡∞∞‡∞¶‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø"
        )

    elif "‡∞é‡∞∞‡±Å‡∞µ‡±Å" in text or "‡∞Æ‡∞Ç‡∞¶‡±Å" in text:
        return (
            "‡∞é‡∞∞‡±Å‡∞µ‡±Å ‡∞≤‡±á‡∞¶‡∞æ ‡∞Æ‡∞Ç‡∞¶‡±Å ‡∞Æ‡±ã‡∞§‡∞æ‡∞¶‡±Å ‡∞™‡∞Ç‡∞ü ‡∞∞‡∞ï‡∞Ç ‡∞Æ‡∞∞‡∞ø‡∞Ø‡±Å ‡∞™‡±ä‡∞≤‡∞Ç ‡∞µ‡∞ø‡∞∏‡±ç‡∞§‡±Ä‡∞∞‡±ç‡∞£‡∞Ç ‡∞Ü‡∞ß‡∞æ‡∞∞‡∞Ç‡∞ó‡∞æ ‡∞Æ‡∞æ‡∞∞‡±Å‡∞§‡±Å‡∞Ç‡∞¶‡∞ø. "
            "‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞®‡∞ø‡∞™‡±Å‡∞£‡±Å‡∞≤ ‡∞∏‡∞≤‡∞π‡∞æ ‡∞§‡±Ä‡∞∏‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø"
        )

    else:
        return "‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞™‡∞Ç‡∞ü, ‡∞µ‡∞æ‡∞§‡∞æ‡∞µ‡∞∞‡∞£‡∞Ç ‡∞≤‡±á‡∞¶‡∞æ ‡∞µ‡±ç‡∞Ø‡∞µ‡∞∏‡∞æ‡∞Ø ‡∞∏‡∞Æ‡∞∏‡±ç‡∞Ø ‡∞ó‡±Å‡∞∞‡∞ø‡∞Ç‡∞ö‡∞ø ‡∞Ö‡∞°‡∞ó‡∞Ç‡∞°‡∞ø"

def speak(answer):
    file_name = f"reply_{uuid.uuid4()}.mp3"
    tts = gTTS(answer, lang="te")
    tts.save(file_name)
    st.audio(file_name, format="audio/mp3")
    os.remove(file_name)

# ------------------ TEXT QUESTION ------------------

st.markdown("## ‚úçÔ∏è ‡∞Æ‡±Ä ‡∞™‡±ç‡∞∞‡∞∂‡±ç‡∞® ‡∞ü‡±à‡∞™‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø")
query = st.text_input("‡∞â‡∞¶‡∞æ: ‡∞µ‡∞∞‡∞ø ‡∞™‡∞Ç‡∞ü‡∞ï‡±Å ‡∞é‡∞∞‡±Å‡∞µ‡±Å ‡∞é‡∞≤‡∞æ ‡∞µ‡±á‡∞Ø‡∞æ‡∞≤‡∞ø?")

if query:
    answer = respond(query)
    st.success(answer)
    speak(answer)

# ------------------ CAMERA INPUT ------------------

st.markdown("## üì∏ ‡∞™‡∞Ç‡∞ü ‡∞≤‡±á‡∞¶‡∞æ ‡∞Ü‡∞ï‡±Å‡∞≤ ‡∞´‡±ã‡∞ü‡±ã ‡∞§‡±Ä‡∞Ø‡∞Ç‡∞°‡∞ø")

image_file = st.camera_input("‡∞ï‡±Ü‡∞Æ‡±Ü‡∞∞‡∞æ ‡∞ì‡∞™‡±Ü‡∞®‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø")

if image_file:
    image = Image.open(image_file)
    st.image(image, caption="‡∞Æ‡±Ä‡∞∞‡±Å ‡∞§‡±Ä‡∞∏‡∞ø‡∞® ‡∞ö‡∞ø‡∞§‡±ç‡∞∞‡∞Ç", use_column_width=True)

    st.info(
        "‡∞à ‡∞ö‡∞ø‡∞§‡±ç‡∞∞‡∞Ç‡∞≤‡±ã ‡∞™‡∞Ç‡∞ü‡∞ï‡±Å ‡∞∏‡∞Ç‡∞¨‡∞Ç‡∞ß‡∞ø‡∞Ç‡∞ö‡∞ø‡∞® ‡∞∏‡∞Æ‡∞∏‡±ç‡∞Ø ‡∞â‡∞Ç‡∞°‡±á ‡∞Ö‡∞µ‡∞ï‡∞æ‡∞∂‡∞Ç ‡∞â‡∞Ç‡∞¶‡∞ø. "
        "‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞∏‡∞Æ‡±Ä‡∞™ ‡∞µ‡±ç‡∞Ø‡∞µ‡∞∏‡∞æ‡∞Ø ‡∞Ö‡∞ß‡∞ø‡∞ï‡∞æ‡∞∞‡∞ø‡∞®‡∞ø ‡∞∏‡∞Ç‡∞™‡±ç‡∞∞‡∞¶‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø."
    )

    speak(
        "‡∞à ‡∞ö‡∞ø‡∞§‡±ç‡∞∞‡∞Ç‡∞≤‡±ã ‡∞™‡∞Ç‡∞ü‡∞ï‡±Å ‡∞∏‡∞Ç‡∞¨‡∞Ç‡∞ß‡∞ø‡∞Ç‡∞ö‡∞ø‡∞® ‡∞∏‡∞Æ‡∞∏‡±ç‡∞Ø ‡∞â‡∞Ç‡∞°‡±á ‡∞Ö‡∞µ‡∞ï‡∞æ‡∞∂‡∞Ç ‡∞â‡∞Ç‡∞¶‡∞ø. "
        "‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞∏‡∞Æ‡±Ä‡∞™ ‡∞µ‡±ç‡∞Ø‡∞µ‡∞∏‡∞æ‡∞Ø ‡∞Ö‡∞ß‡∞ø‡∞ï‡∞æ‡∞∞‡∞ø‡∞®‡∞ø ‡∞∏‡∞Ç‡∞™‡±ç‡∞∞‡∞¶‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø."
    )

# ------------------ FOOTER ------------------

st.markdown("---")
st.caption(
    "‚ö†Ô∏è ‡∞à ‡∞Ø‡∞æ‡∞™‡±ç ‡∞∏‡±Ç‡∞ö‡∞®‡∞≤‡±Å ‡∞Æ‡∞æ‡∞§‡±ç‡∞∞‡∞Æ‡±á ‡∞á‡∞∏‡±ç‡∞§‡±Å‡∞Ç‡∞¶‡∞ø. "
    "‡∞∞‡∞∏‡∞æ‡∞Ø‡∞®‡∞æ‡∞≤ ‡∞µ‡∞ø‡∞®‡∞ø‡∞Ø‡±ã‡∞ó‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞Æ‡±Å‡∞Ç‡∞¶‡±Å ‡∞®‡∞ø‡∞™‡±Å‡∞£‡±Å‡∞≤ ‡∞∏‡∞≤‡∞π‡∞æ ‡∞§‡∞™‡±ç‡∞™‡∞®‡∞ø‡∞∏‡∞∞‡∞ø."
)
